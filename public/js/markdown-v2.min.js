var requirejs,require,define;!function(global,setTimeout){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.6",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var i;if(e)for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}function eachReverse(e,t){var i;if(e)for(i=e.length-1;-1<i&&(!e[i]||!t(e[i],i,e));i-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,r){return t&&eachProp(t,(function(t,n){!i&&hasProp(e,n)||(!r||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[n]=t:(e[n]||(e[n]={}),mixin(e[n],t,i,r)))})),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),(function(e){t=t[e]})),t}function makeError(e,t,i,r){var n=new Error(t+"\nhttps://requirejs.org/docs/errors.html#"+e);return n.requireType=e,n.requireModules=r,i&&(n.originalError=i),n}if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,r){var n,o,a=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=i,i=r):e=[]),o&&o.context&&(a=o.context),(n=getOwn(contexts,a))||(n=contexts[a]=req.s.newContext(a)),o&&n.configure(o),n.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],(function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}})),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var r=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return r.type=e.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r},req.load=function(e,t,i){var r,n=e&&e.config||{};if(isBrowser)return(r=req.createNode(n,t,i)).setAttribute("data-requirecontext",e.contextName),r.setAttribute("data-requiremodule",t),!r.attachEvent||r.attachEvent.toString&&r.attachEvent.toString().indexOf("[native code")<0||isOpera?(r.addEventListener("load",e.onScriptLoad,!1),r.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,r.attachEvent("onreadystatechange",e.onScriptLoad)),r.src=i,n.onNodeCreated&&n.onNodeCreated(r,n,t,i),currentlyAddingScript=r,baseElement?head.insertBefore(r,baseElement):head.appendChild(r),currentlyAddingScript=null,r;if(isWebWorker)try{setTimeout((function(){}),0),importScripts(i),e.completeLoad(t)}catch(r){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,r,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),(function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(mainScript=(src=mainScript.split("/")).pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0})),define=function(e,t,i){var r,n;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,(function(e,i){t.push(i)})),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript())&&(e||(e=r.getAttribute("data-requiremodule")),n=contexts[r.getAttribute("data-requirecontext")]),n?(n.defQueue.push([e,t,i]),n.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}function newContext(e){var t,i,r,n,o,a={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},s={},u={},c={},d=[],p={},f={},l={},h=1,m=1;function g(e,t,i){var r,n,o,s,u,c,d,p,f,l,h=t&&t.split("/"),m=a.map,g=m&&m["*"];if(e&&(c=(e=e.split("/")).length-1,a.nodeIdCompat&&jsSuffixRegExp.test(e[c])&&(e[c]=e[c].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&h&&(e=h.slice(0,h.length-1).concat(e)),function(e){var t,i;for(t=0;t<e.length;t++)if("."===(i=e[t]))e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;0<t&&(e.splice(t-1,2),t-=2)}}(e),e=e.join("/")),i&&m&&(h||g)){e:for(o=(n=e.split("/")).length;0<o;o-=1){if(u=n.slice(0,o).join("/"),h)for(s=h.length;0<s;s-=1)if((r=getOwn(m,h.slice(0,s).join("/")))&&(r=getOwn(r,u))){d=r,p=o;break e}!f&&g&&getOwn(g,u)&&(f=getOwn(g,u),l=o)}!d&&f&&(d=f,p=l),d&&(n.splice(0,p,d),e=n.join("/"))}return getOwn(a.pkgs,e)||e}function v(e){isBrowser&&each(scripts(),(function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0}))}function x(e){var t=getOwn(a.paths,e);if(t&&isArray(t)&&1<t.length)return t.shift(),r.require.undef(e),r.makeRequire(null,{skipMap:!0})([e]),!0}function b(e){var t,i=e?e.indexOf("!"):-1;return-1<i&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function q(e,t,i,n){var o,a,s,u,c=null,d=t?t.name:null,f=e,l=!0,v="";return e||(l=!1,e="_@r"+(h+=1)),c=(u=b(e))[0],e=u[1],c&&(c=g(c,d,n),a=getOwn(p,c)),e&&(c?v=i?e:a&&a.normalize?a.normalize(e,(function(e){return g(e,d,n)})):-1===e.indexOf("!")?g(e,d,n):e:(c=(u=b(v=g(e,d,n)))[0],v=u[1],i=!0,o=r.nameToUrl(v))),{prefix:c,name:v,parentMap:t,unnormalized:!!(s=!c||a||i?"":"_unnormalized"+(m+=1)),url:o,originalName:f,isDefine:l,id:(c?c+"!"+v:v)+s}}function E(e){var t=e.id,i=getOwn(s,t);return i||(i=s[t]=new r.Module(e)),i}function w(e,t,i){var r=e.id,n=getOwn(s,r);!hasProp(p,r)||n&&!n.defineEmitComplete?(n=E(e)).error&&"error"===t?i(n.error):n.on(t,i):"defined"===t&&i(p[r])}function y(e,t){var i=e.requireModules,r=!1;t?t(e):(each(i,(function(t){var i=getOwn(s,t);i&&(i.error=e,i.events.error&&(r=!0,i.emit("error",e)))})),r||req.onError(e))}function S(){globalDefQueue.length&&(each(globalDefQueue,(function(e){var t=e[0];"string"==typeof t&&(r.defQueueMap[t]=!0),d.push(e)})),globalDefQueue=[])}function k(e){delete s[e],delete u[e]}function M(){var e,i,n=1e3*a.waitSeconds,c=n&&r.startTime+n<(new Date).getTime(),d=[],f=[],l=!1,h=!0;if(!t){if(t=!0,eachProp(u,(function(e){var t=e.map,r=t.id;if(e.enabled&&(t.isDefine||f.push(e),!e.error))if(!e.inited&&c)x(r)?l=i=!0:(d.push(r),v(r));else if(!e.inited&&e.fetched&&t.isDefine&&(l=!0,!t.prefix))return h=!1})),c&&d.length)return(e=makeError("timeout","Load timeout for modules: "+d,null,d)).contextName=r.contextName,y(e);h&&each(f,(function(e){!function e(t,i,r){var n=t.map.id;t.error?t.emit("error",t.error):(i[n]=!0,each(t.depMaps,(function(n,o){var a=n.id,u=getOwn(s,a);!u||t.depMatched[o]||r[a]||(getOwn(i,a)?(t.defineDep(o,p[a]),t.check()):e(u,i,r))})),r[n]=!0)}(e,{},{})})),c&&!i||!l||!isBrowser&&!isWebWorker||o||(o=setTimeout((function(){o=0,M()}),50)),t=!1}}function O(e){hasProp(p,e[0])||E(q(e[0],null,!0)).init(e[1],e[2])}function j(e,t,i,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(i,t,!1)}function P(e){var t=e.currentTarget||e.srcElement;return j(t,r.onScriptLoad,"load","onreadystatechange"),j(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function R(){var e;for(S();d.length;){if(null===(e=d.shift())[0])return y(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));O(e)}r.defQueueMap={}}return n={require:function(e){return e.require?e.require:e.require=r.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?p[e.map.id]=e.exports:e.exports=p[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(a.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},(i=function(e){this.events=getOwn(c,e.id)||{},this.map=e,this.shim=getOwn(a.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,i,r){r=r||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,(function(e){this.emit("error",e)}))),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();r.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,(function(){return e.prefix?this.callPlugin():this.load()})))}},load:function(){var e=this.map.url;f[e]||(f[e]=!0,r.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,n=this.depExports,o=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{o=r.execCb(i,a,n,o)}catch(t){e=t}else o=r.execCb(i,a,n,o);if(this.map.isDefine&&void 0===o&&((t=this.module)?o=t.exports:this.usingExports&&(o=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",y(this.error=e)}else o=a;if(this.exports=o,this.map.isDefine&&!this.ignore&&(p[i]=o,req.onResourceLoad)){var s=[];each(this.depMaps,(function(e){s.push(e.normalizedMap||e)})),req.onResourceLoad(r,this.map,s)}k(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(r.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,i=q(e.prefix);this.depMaps.push(i),w(i,"defined",bind(this,(function(i){var n,o,u,c=getOwn(l,this.map.id),d=this.map.name,p=this.map.parentMap?this.map.parentMap.name:null,f=r.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(i.normalize&&(d=i.normalize(d,(function(e){return g(e,p,!0)}))||""),w(o=q(e.prefix+"!"+d,this.map.parentMap,!0),"defined",bind(this,(function(e){this.map.normalizedMap=o,this.init([],(function(){return e}),null,{enabled:!0,ignore:!0})}))),void((u=getOwn(s,o.id))&&(this.depMaps.push(o),this.events.error&&u.on("error",bind(this,(function(e){this.emit("error",e)}))),u.enable()))):c?(this.map.url=r.nameToUrl(c),void this.load()):((n=bind(this,(function(e){this.init([],(function(){return e}),null,{enabled:!0})}))).error=bind(this,(function(e){this.inited=!0,(this.error=e).requireModules=[t],eachProp(s,(function(e){0===e.map.id.indexOf(t+"_unnormalized")&&k(e.map.id)})),y(e)})),n.fromText=bind(this,(function(i,o){var s=e.name,u=q(s),c=useInteractive;o&&(i=o),c&&(useInteractive=!1),E(u),hasProp(a.config,t)&&(a.config[s]=a.config[t]);try{req.exec(i)}catch(i){return y(makeError("fromtexteval","fromText eval for "+t+" failed: "+i,i,[t]))}c&&(useInteractive=!0),this.depMaps.push(u),r.completeLoad(s),f([s],n)})),void i.load(e.name,f,n,a))}))),r.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){(u[this.map.id]=this).enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,(function(e,t){var i,o,a;if("string"==typeof e){if(e=q(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,a=getOwn(n,e.id))return void(this.depExports[t]=a(this));this.depCount+=1,w(e,"defined",bind(this,(function(e){this.undefed||(this.defineDep(t,e),this.check())}))),this.errback?w(e,"error",bind(this,this.errback)):this.events.error&&w(e,"error",bind(this,(function(e){this.emit("error",e)})))}i=e.id,o=s[i],hasProp(n,i)||!o||o.enabled||r.enable(e,this)}))),eachProp(this.pluginMaps,bind(this,(function(e){var t=getOwn(s,e.id);t&&!t.enabled&&r.enable(e,this)}))),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],(function(e){e(t)})),"error"===e&&delete this.events[e]}},(r={config:a,contextName:e,registry:s,defined:p,urlFetched:f,defQueue:d,defQueueMap:{},Module:i,makeModuleMap:q,nextTick:req.nextTick,onError:y,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,i){return(-1===i.indexOf("?")?"?":"&")+t}}var i=a.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,(function(e,t){n[t]?(a[t]||(a[t]={}),mixin(a[t],e,!0,!0)):a[t]=e})),e.bundles&&eachProp(e.bundles,(function(e,t){each(e,(function(e){e!==t&&(l[e]=t)}))})),e.shim&&(eachProp(e.shim,(function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=r.makeShimExports(e)),i[t]=e})),a.shim=i),e.packages&&each(e.packages,(function(e){var t;t=(e="string"==typeof e?{name:e}:e).name,e.location&&(a.paths[t]=e.location),a.pkgs[t]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")})),eachProp(s,(function(e,t){e.inited||e.map.unnormalized||(e.map=q(t,null,!0))})),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(t,i){function o(a,u,c){var d,f;return i.enableBuildCallback&&u&&isFunction(u)&&(u.__requireJsBuild=!0),"string"==typeof a?isFunction(u)?y(makeError("requireargs","Invalid require call"),c):t&&hasProp(n,a)?n[a](s[t.id]):req.get?req.get(r,a,t,o):(d=q(a,t,!1,!0).id,hasProp(p,d)?p[d]:y(makeError("notloaded",'Module name "'+d+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(R(),r.nextTick((function(){R(),(f=E(q(null,t))).skipMap=i.skipMap,f.init(a,u,c,{enabled:!0}),M()})),o)}return i=i||{},mixin(o,{isBrowser:isBrowser,toUrl:function(e){var i,n=e.lastIndexOf("."),o=e.split("/")[0];return-1!==n&&(!("."===o||".."===o)||1<n)&&(i=e.substring(n,e.length),e=e.substring(0,n)),r.nameToUrl(g(e,t&&t.id,!0),i,!0)},defined:function(e){return hasProp(p,q(e,t,!1,!0).id)},specified:function(e){return e=q(e,t,!1,!0).id,hasProp(p,e)||hasProp(s,e)}}),t||(o.undef=function(e){S();var i=q(e,t,!0),n=getOwn(s,e);n.undefed=!0,v(e),delete p[e],delete f[i.url],delete c[e],eachReverse(d,(function(t,i){t[0]===e&&d.splice(i,1)})),delete r.defQueueMap[e],n&&(n.events.defined&&(c[e]=n.events),k(e))}),o},enable:function(e){getOwn(s,e.id)&&E(e).enable()},completeLoad:function(e){var t,i,n,o=getOwn(a.shim,e)||{},u=o.exports;for(S();d.length;){if(null===(i=d.shift())[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);O(i)}if(r.defQueueMap={},n=getOwn(s,e),!t&&!hasProp(p,e)&&n&&!n.inited){if(!(!a.enforceDefine||u&&getGlobal(u)))return x(e)?void 0:y(makeError("nodefine","No define call for "+e,null,[e]));O([e,o.deps||[],o.exportsFn])}M()},nameToUrl:function(e,t,i){var n,o,s,u,c,d,p=getOwn(a.pkgs,e);if(p&&(e=p),d=getOwn(l,e))return r.nameToUrl(d,t,i);if(req.jsExtRegExp.test(e))u=e+(t||"");else{for(n=a.paths,s=(o=e.split("/")).length;0<s;s-=1)if(c=getOwn(n,o.slice(0,s).join("/"))){isArray(c)&&(c=c[0]),o.splice(0,s,c);break}u=o.join("/"),u=("/"===(u+=t||(/^data\:|^blob\:|\?/.test(u)||i?"":".js")).charAt(0)||u.match(/^[\w\+\.\-]+:/)?"":a.baseUrl)+u}return a.urlArgs&&!/^blob\:/.test(u)?u+a.urlArgs(e,u):u},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,i,r){return t.apply(r,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=P(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=P(e);if(!x(t.id)){var i=[];return eachProp(s,(function(e,r){0!==r.indexOf("_@r")&&each(e.depMaps,(function(e){if(e.id===t.id)return i.push(r),!0}))})),y(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}}).require=r.makeRequire(),r}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState||eachReverse(scripts(),(function(e){if("interactive"===e.readyState)return interactiveScript=e})),interactiveScript}}(this,"undefined"==typeof setTimeout?void 0:setTimeout);
var Markdown;define("constants",[],(function(){var e={EDITOR_DEFAULT_PADDING:5,fontSize:14,fontFamily:"Menlo, 'Ubuntu Mono', Consolas, 'Courier New',  'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft Yahei', sans-serif;"};return e})),define("utils",["underscore","crel","xregexp"],(function(_,crel,XRegExp){var utils={};function jqElt(e){return _.isString(e)?$(e):e}function inputError(e,n){void 0!==n&&(e.stop(!0,!0).addClass("error").delay(1e3).switchClass("error"),n.stopPropagation())}utils.getURLParameter=function(e){var n=new RegExp("(?:\\?|\\#\\!|&)"+e+"=(.+?)(?:&|\\#|$)");try{return decodeURIComponent(n.exec(location.search+location.hash)[1])}catch(e){return}},utils.getInputValue=function(e){return(e=jqElt(e)).val()},utils.setInputValue=function(e,n){(e=jqElt(e)).val(n)},utils.getInputTextValue=function(e,n,t){var o=(e=jqElt(e)).val();if(void 0!==o){if(0!==(o=utils.trim(o)).length&&(void 0===t||o.match(t)))return o;inputError(e,n)}else inputError(e,n)},utils.getInputIntValue=function(e,n,t,o){e=jqElt(e);var i=utils.getInputTextValue(e,n);if(void 0!==i){if(i=parseInt(i,10),!(isNaN(i)||void 0!==t&&i<t||void 0!==o&&i>o))return i;inputError(e,n)}},utils.getInputRegExpValue=function(e,n){e=jqElt(e);var t=utils.getInputTextValue(e,n);if(void 0!==t){try{new RegExp(t)}catch(t){return void inputError(e,n)}return t}},utils.getInputJsValue=function(element,event){element=jqElt(element);var value=utils.getInputTextValue(element,event);if(void 0!==value){try{eval("var test="+value)}catch(e){return void inputError(element,event)}return value}},utils.getInputChecked=function(e){return(e=jqElt(e)).prop("checked")},utils.setInputChecked=function(e,n){(e=jqElt(e)).prop("checked",n).change()},utils.getInputRadio=function(e){return $("input:radio[name="+e+"]:checked").prop("value")},utils.setInputRadio=function(e,n){$("input:radio[name="+e+"][value="+n+"]").prop("checked",!0).change()},utils.resetModalInputs=function(){$(".modal input[type=text]:not([disabled]), .modal input[type=password], .modal textarea").val(""),$(".modal input[type=checkbox]").prop("checked",!1).change()},utils.trim=function(e){return $.trim(e)};var nonWordChars=XRegExp("[^\\p{L}\\p{N}-]","g");utils.slugify=function(e){return e.toLowerCase().replace(/\s/g,"-").replace(nonWordChars,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},utils.checkUrl=function(e,n){return e?(0!==e.indexOf("http")&&(e="http://"+e),n&&-1===e.indexOf("/",e.length-1)&&(e+="/"),e):e},utils.randomString=function(){return _.random(4294967296).toString(36)},utils.updateCurrentTime=function(){utils.currentTime=(new Date).getTime()},utils.updateCurrentTime(),utils.storeAttributes=function(e){},utils.retrieveIndexArray=function(e){},utils.appendIndexToArray=function(e,n){},utils.removeIndexFromArray=function(e,n){},utils.retrieveIgnoreError=function(e){};var eventList=[];return utils.logValue=function(e){},utils.logStackTrace=function(){},utils.formatEventList=function(){var e=[];return _.each(eventList,(function(n){e.push("\n"),_.isString(n)?e.push(n):_.isArray(n)&&(e.push(n[5]||""),e.push(n[6]||""))})),e.join("")},utils})),define("classes/Extension",[],(function(){return function(e,n,t,o,i){this.extensionId=e,this.extensionName=n,this.isOptional=t,this.disableInViewer=o,this.disableInLight=i}})),define("settings",[],(function(){return{layoutOrientation:"horizontal",lazyRendering:!0,editorFontFamily:'Menlo, Consolas, "Courier New", Courier, monospace',editorFontSize:13,shortcuts:{},extensionSettings:{}}})),Markdown="object"==typeof exports&&"function"==typeof require?exports:{},function(){function e(e){return e}Markdown.HookCollection=function(){},Markdown.HookCollection.prototype={chain:function(n,t){var o=this[n];if(!o)throw new Error("unknown hook "+n);this[n]=o===e?t:function(e){var n=Array.prototype.slice.call(arguments,0);return n[0]=o.apply(null,n),t.apply(null,n)}},set:function(e,n){if(!this[e])throw new Error("unknown hook "+e);this[e]=n},addNoop:function(n){this[n]=e},addFalse:function(e){this[e]=function(e){return!1}}}}(),define("extensions/markdownExtra",["underscore","utils","classes/Extension","pagedown-extra"],(function(e,n,t){var o=new t("markdownExtra","Markdown Extra",!0);function i(e){e.hooks.chain("onPreviewRefresh",(function(){$("#preview-contents pre code").each((function(){var e=$(this).attr("class");"language-flow"!=e&&"language-sequence"!=e&&"language-mermaid"!=e&&"language-chart"!=e&&$(this).parent().addClass("prettyprint linenums")}))}))}return o.defaultConfig={extensions:["fenced_code_gfm","tables","def_list","attr_list","footnotes","strikethrough","newlines"],intraword:!0,comments:!0,highlighter:"prettify"},o.onEventMgrCreated=function(e){e},o.onToggleMode=i,o.onPagedownConfigure=function(e){var n=e.getConverter();if(!0===o.config.intraword){n.setOptions({_DoItalicsAndBold:function(e){return e=(e=e.replace(/([^\w*]|^)(\*\*|__)(?=\S)(.+?[*_]*)(?=\S)\2(?=[^\w*]|$)/g,"$1<strong>$3</strong>")).replace(/([^\w*]|^)(\*|_)(?=\S)(.+?)(?=\S)\2(?=[^\w*]|$)/g,"$1<em>$3</em>")}})}!0===o.config.comments&&n.hooks.chain("postConversion",(function(e){return e.replace(/<!--.*?-->/g,(function(e){return e.replace(/^<!---(.+?)-?-->$/,' <span class="comment label label-danger">$1</span> ')}))}));var t={extensions:o.config.extensions,highlighter:"prettify"};i(e),Markdown.Extra.init(n,t)},o})),define("libs/mathjax_init",["underscore","settings"],(function(e,n){var t=document.createElement("script");t.type="text/x-mathjax-config";t.innerHTML=n.template('MathJax.Hub.Config({\n\tskipStartupTypeset: true,\n    "HTML-CSS": {\n        preferredFont: "TeX",\n        availableFonts: [\n            "STIX",\n            "TeX"\n        ],\n        linebreaks: {\n            automatic: true\n        },\n        EqnChunk: 10,\n        imageFont: null\n    },\n    tex2jax: <%= tex2jax || \'{ inlineMath: [["$","$"],["\\\\\\\\\\\\\\\\(","\\\\\\\\\\\\\\\\)"]], displayMath: [["$$","$$"],["\\\\\\\\[","\\\\\\\\]"]], processEscapes: true }\' %>,\n    TeX: $.extend({\n        noUndefined: {\n            attributes: {\n                mathcolor: "red",\n                mathbackground: "#FFEEEE",\n                mathsize: "90%"\n            }\n        },\n        Safe: {\n            allow: {\n                URLs: "safe",\n                classes: "safe",\n                cssIDs: "safe",\n                styles: "safe",\n                fontsize: "all"\n            }\n        }\n    }, <%= tex %>),\n    messageStyle: "none"\n});\n',{tex:e.extensionSettings.mathJax?e.extensionSettings.mathJax.tex:"undefined",tex2jax:e.extensionSettings.mathJax?e.extensionSettings.mathJax.tex2jax:void 0}),document.getElementsByTagName("head")[0].appendChild(t)})),define("extensions/mathJax",["utils","classes/Extension","mathjax"],(function(e,n){var t,o=new n("mathJax","MathJax",!0);function i(e,n,t){var o=l.slice(e,n+1).join("").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");for(w.Browser.isMSIE&&(o=o.replace(/(%[^\n]*)\n/g,"$1<br/>\n"));n>e;)l[n]="",n--;l[e]="@@"+g.length+"@@",t&&(o=t(o)),g.push(o),c=d=u=null}function r(e){var n;c=d=u=null,g=[],/`/.test(e)?(e=e.replace(/~/g,"~T").replace(/(^|[^\\])(`+)([^\n]*?[^`\n])\2(?!`)/gm,(function(e){return e.replace(/\$/g,"~D")})),n=function(e){return e.replace(/~([TD])/g,(function(e,n){return{T:"~",D:"$"}[n]}))}):n=function(e){return e},l=v(e.replace(/\r\n?/g,"\n"),b);e=1;for(var t=l.length;e<t;e+=2){var o=l[e];"@"===o.charAt(0)?(l[e]="@@"+g.length+"@@",g.push(o)):c?o===d?f?u=e:i(c,e,n):o.match(/\n.*\n/)?(u&&i(c,e=u,n),c=d=u=null,f=0):"{"===o?f++:"}"===o&&f&&f--:o===h||"$$"===o?(c=e,d=o,f=0):"begin"===o.substr(1,5)&&(c=e,d="\\end"+o.substr(6),f=0)}return u&&i(c,u,n),n(l.join(""))}function a(e){return e=e.replace(/@@(\d+)@@/g,(function(e,n){return g[n]})),g=null,e}function s(){p=!1,w.cancelTypeset=!1,w.Queue(["Typeset",w,m]),w.Queue(t)}o.defaultConfig={tex:"{}",tex2jax:'{ inlineMath: [["$","$"],["\\\\\\\\(","\\\\\\\\)"]], displayMath: [["$$","$$"],["\\\\[","\\\\]"]], processEscapes: true }'},o.onPagedownConfigure=function(e){m=document.getElementById("preview-contents");var n=e.getConverter();n.hooks.chain("preConversion",r),n.hooks.chain("postConversion",a)},o.onAsyncPreview=function(e){t=e,!p&&(p=!0,w.Cancel(),w.Queue(s))};var l,c,d,u,f,g,p=!1,m=null,h="$",w=MathJax.Hub;w.Queue((function(){!0,w.processUpdateTime=50,w.Config({"HTML-CSS":{EqnChunk:10,EqnChunkFactor:1},SVG:{EqnChunk:10,EqnChunkFactor:1}})}));var v,b=/(\$\$?|\\(?:begin|end)\{[a-z]*\*?\}|\\[\\{}$]|[{}]|(?:\n\s*)+|@@\d+@@)/i;return v=3==="aba".split(/(b)/).length?function(e,n){return e.split(n)}:function(e,n){var t,o=[];if(!n.global){t=n.toString();var i="";t=t.replace(/^\/(.*)\/([im]*)$/,(function(e,n,t){return i=t,n})),n=RegExp(t,i+"g")}for(var r=n.lastIndex=0;t=n.exec(e);)o.push(e.substring(r,t.index)),o.push.apply(o,t.slice(1)),r=t.index+t[0].length;return o.push(e.substring(r)),o},function(){var e=MathJax.Hub;if(!e.Cancel){e.cancelTypeset=!1,e.Register.StartupHook("HTML-CSS Jax Config",(function(){var n=MathJax.OutputJax["HTML-CSS"],t=n.Translate;n.Augment({Translate:function(o,i){if(e.cancelTypeset||i.cancelled)throw Error("MathJax Canceled");return t.call(n,o,i)}})})),e.Register.StartupHook("SVG Jax Config",(function(){var n=MathJax.OutputJax.SVG,t=n.Translate;n.Augment({Translate:function(o,i){if(e.cancelTypeset||i.cancelled)throw Error("MathJax Canceled");return t.call(n,o,i)}})})),e.Register.StartupHook("TeX Jax Config",(function(){var n=MathJax.InputJax.TeX,t=n.Translate;n.Augment({Translate:function(o,i){if(e.cancelTypeset||i.cancelled)throw Error("MathJax Canceled");return t.call(n,o,i)}})}));var n=e.processError;e.processError=function(t,o,i){return"MathJax Canceled"!==t.message?n.call(e,t,o,i):(MathJax.Message.Clear(0,0),o.jaxIDs=[],o.jax={},o.scripts=[],o.i=o.j=0,o.cancelled=!0,null)},e.Cancel=function(){this.cancelTypeset=!0}}}(),o})),define("extensions/markdownSectionParser",["underscore","extensions/markdownExtra","classes/Extension"],(function(e,n,t){var o,i=new t("markdownSectionParser","Markdown section parser");return i.onEventMgrCreated=function(e){o=e},i.onPagedownConfigure=function(t){var i="^.+[ \\t]*\\n=+[ \\t]*\\n+|^.+[ \\t]*\\n-+[ \\t]*\\n+|^\\#{1,6}[ \\t]*.+?[ \\t]*\\#*\\n+";n.enabled&&e.some(n.config.extensions,(function(e){return"fenced_code_gfm"==e}))&&(i="^```.*\\n[\\s\\S]*?\\n```|"+i),i="^```.*\\n[\\s\\S]*?\\n```|"+(i="^[ \\t]*\\n\\\\?\\\\begin\\{[a-z]*\\*?\\}[\\s\\S]*?\\\\end\\{[a-z]*\\*?\\}|"+(i="^[ \\t]*\\n\\\\\\\\[[\\s\\S]*?\\\\\\\\]|"+(i="^[ \\t]*\\n\\$\\$[\\s\\S]*?\\$\\$|"+i))),i=new RegExp(i,"gm"),t.getConverter().hooks.chain("preConversion",(function(n){o.previewStartTime=new Date;var t=n+"\n\n";function r(e,n){var o=t.substring(e,n);a.push({text:o,textWithDelimiter:'\n<div class="se-section-delimiter"></div>\n\n'+o+"\n"})}var a=[],s=0;return t.replace(i,(function(e,n){r(s,n),s=n})),r(s,n.length),o.onSectionsCreated(a),e.reduce(a,(function(e,n){return e+n.textWithDelimiter}),"")}))},i})),define("extensions/partialRendering",["underscore","crel","extensions/markdownExtra","classes/Extension"],(function(e,n,t,o,i){var r,a,s=new o("partialRendering","Partial Rendering",!0),l=0,c=[],d=[],u=[],f=!1;var g=!1,p=!1;s.onSectionsCreated=function(n){var t=[],o="\n";p=!1,e.each(n,(function(e){var n=e.textWithDelimiter+"\n";g&&(n=n.replace(/^```.*\n[\s\S]*?\n```|\n[ ]{0,3}\[\^(.+?)\]\:[ \t]*\n?([\s\S]*?)\n{1,2}((?=\n[ ]{0,3}\S)|$)/gm,(function(e,n){return n?(p=!0,o+=e.replace(/^\s*\n/gm,"")+"\n",""):e}))),n=n.replace(/^```.*\n[\s\S]*?\n```|^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,(function(e,n){return n?(o+=e.replace(/^\s*\n/gm,"")+"\n",""):e})),t.push({id:++l,text:n+"\n"})})),function(n,t){if(u=[],d=[],a=void 0,!0===f||r!=t)return f=!1,r=t,d=c,c=n,void(u=n);var o=c.length;e.some(c,(function(e,t){if(t>=n.length||e.text!=n[t].text)return o=t,!0}));var i=-c.length;e.some(c.slice().reverse(),(function(e,t){if(t>=n.length||e.text!=n[n.length-t-1].text)return i=-t,!0})),o-i>c.length&&(i=o-c.length);var s=c.slice(0,o);u=n.slice(o,n.length+i);var l=c.slice(c.length+i,c.length);a=e.first(l),d=c.slice(o,c.length+i),c=s.concat(u).concat(l)}(t,o)};var m,h,w={};function v(e){var n=e.id.substring(3);w[n]=e}function b(){e.each(d,(function(e){var n=document.getElementById("wmd-preview-section-"+e.id);h.removeChild(n)}));var t=document.getElementById("wmd-preview"),o=t.firstChild;var i=document.createDocumentFragment();e.each(u,(function(t){i.appendChild(function(t){for(var i=n("div",{id:"wmd-preview-section-"+t.id,class:"wmd-preview-section preview-content"}),r=!1;o;){var a=o.nextSibling;if(!0===r&&"DIV"==o.tagName&&"se-section-delimiter"==o.className)break;r=!0,"DIV"==o.tagName&&"footnotes"==o.className?e.each(o.querySelectorAll("ol > li"),v):i.appendChild(o),o=a}return i}(t))})),t.innerHTML="";var r=m;void 0!==a&&(r=document.getElementById("wmd-preview-section-"+a.id)),h.insertBefore(i,r),m.innerHTML="";var s=[];if(!0===p){var l=n("ol");e.each(h.querySelectorAll("a.footnote"),(function(e,n){e.textContent=n+1;var t=e.id.substring(6);s.push(t),l.appendChild(w[t].cloneNode(!0))})),s.length>0&&m.appendChild(n("div",{class:"footnotes"},n("hr"),l)),w=e.pick(w,s)}}function x(n){n.getConverter().hooks.chain("preConversion",(function(){var n=e.map(u,(function(e){return e.text}));return n.push(r+"\n\n"),n.join("")})),n.hooks.chain("onPreviewRefresh",(function(){b()}))}return s.onPagedownConfigure=x,s.onToggleMode=x,s.onInit=function(){t.enabled&&e.some(t.config.extensions,(function(e){return"footnotes"==e}))&&(g=!0)},s.onReady=function(){m=n("div",{id:"wmd-preview-section-footnotes",class:"preview-content"}),(h=document.getElementById("preview-contents")).appendChild(m)},s.onFileSelected=function(){f=!0},s})),define("extensions/prismJsToolbar",["require","underscore","utils","classes/Extension"],(function(e,n,t,o){let i=new o("prismPluginToolbar","prism Plugin Toolbar",!0),r=document.getElementById("preview-contents");function a(e){var n;if(document.body.createTextRange)(n=document.body.createTextRange()).moveToElementText(e),n.select();else if(window.getSelection){n=window.getSelection();var t=document.createRange();t.selectNodeContents(e),n.removeAllRanges(),n.addRange(t)}return n}function s(e){if("undefined"==typeof Prism)throw new Error("Prism has not loaded yet.");e.hooks.chain("onPreviewRefresh",(function(){!function(){let e=r.querySelectorAll("pre > .code-toolbar > .toolbar");n.each(e,(function(e){e.innerHTML=""}))}(),function(){let e=r.querySelectorAll("pre > .code-toolbar > .toolbar");n.each(e,(function(e){let n=document.createElement("button");n.innerHTML="Copy",n.addEventListener("click",(function(){if(nodeIsLocked(this))return;let e=a(this.parentNode.parentNode.previousElementSibling);document.execCommand("Copy"),e.empty(),n.innerHTML="Copied!",lockNode(this),setTimeout(()=>{this.innerHTML="Copy",unlockNode(this),this.blur()},ATTR_TIMEOUT_VALUE)}));let t=document.createElement("div");t.classList.add("toolbar-item"),t.appendChild(n),e.appendChild(t)}))}()}))}return i.onPagedownConfigure=s,i.onToggleMode=s,i})),define("extensions/umlDiagrams",["require","underscore","utils","classes/Extension","crel"],(function(e,n,t,o,i){var r=new o("umlDiagrams","UML Diagrams",!0);r.defaultConfig={flowchartOptions:["{",'   "line-width": 2,','   "font-family": "sans-serif",','   "font-weight": "normal"',"}"].join("\n")};var a=document.getElementById("preview-contents");function s(t){t.hooks.chain("onPreviewRefresh",(function(){var t,o,s,l;(t=a.querySelectorAll(".prettyprint > .language-sequence"))&&0!=t.length&&e(["Diagram"],(function(e){n.each(t,(function(n){try{var t=e.parse(n.textContent),o=n.parentNode,r=i("div",{class:"sequence-diagram"});o.parentNode.replaceChild(r,o),t.drawSVG(r,{theme:"simple"})}catch(e){console.error(e)}}))})),(o=a.querySelectorAll(".prettyprint > .language-flow"))&&0!=o.length&&e(["flow-chart"],(function(e){n.each(o,(function(n){try{var t=e.parse(n.textContent),o=n.parentNode,a=i("div",{class:"flow-chart"});o.parentNode.replaceChild(a,o),t.drawSVG(a,JSON.parse(r.config.flowchartOptions))}catch(e){console.error(e)}}))})),(s=a.querySelectorAll("pre.prettyprint.linenums.language-mermaid"))&&0!=s.length&&n.each(s,(function(e){try{let t="";$(e).children().children("ol").children("li").each((function(){t=t+$(this).text()+"\n"}));var n=i("div",{class:"mermaid flow-chart",style:"max-width: 960px; margin:0 auto;"},t);e.replaceWith(n),mermaid.init({noteMargin:10},".mermaid")}catch(e){console.error(e)}})),(l=a.querySelectorAll("pre.prettyprint.linenums.language-chart"))&&0!=l.length&&n.each(l,(function(e){try{var n=JSON.parse($(e).children().children()[0].textContent),t=i("canvas",{});e.replaceWith(t);var o=t.getContext("2d");new Chart(o,n)}catch(e){console.error(e)}}))}))}return r.onPagedownConfigure=s,r.onToggleMode=s,r})),define("extensions/toc",["underscore","utils","classes/Extension"],(function(e,n,t){var o,i=new t("toc","Table of Contents",!0);function r(e,n,t){this.tagName=e,this.anchor=n,this.text=t,this.children=[]}function a(){var t={};var a=[];return e.each(o.querySelectorAll("h1, h2, h3, h4, h5, h6"),(function(o){a.push(new r(o.tagName,function(o){for(var i=o.id||n.slugify(o.textContent)||"title",r=i,a=0;e.has(t,r);)r=i+"-"+ ++a;return t[r]=!0,o.id=r,r}(o),o.textContent))})),'<div class="toc">\n<ul>\n'+(a=function n(t,o){var a,s="H"+(o=o||1),l=[];function c(){void 0!==a&&(a.children.length>0&&(a.children=n(a.children,o+1)),l.push(a))}return e.each(t,(function(e){e.tagName!=s?o!==i.config.maxDepth&&(void 0===a&&(a=new r),a.children.push(e)):(c(),a=e)})),c(),l}(a)).join("")+"</ul>\n</div>\n"}return i.defaultConfig={marker:"\\[(TOC|toc)\\]",maxDepth:6,button:!0},r.prototype.childrenToString=function(){if(0===this.children.length)return"";var n="<ul>\n";return e.each(this.children,(function(e){n+=e.toString()})),n+="</ul>\n"},r.prototype.toString=function(){var e="<li>";return this.anchor&&this.text&&(e+='<a href="#'+this.anchor+'">'+this.text+"</a>"),e+=this.childrenToString()+"</li>\n"},i.onPagedownConfigure=function(n){o=document.getElementById("preview-contents");var t=new RegExp("^"+i.config.marker+"$");n.hooks.chain("onPreviewRefresh",(function(){var n=document.querySelectorAll(".table-of-contents, .toc"),i=a();e.each(o.getElementsByTagName("p"),(function(e){t.test(e.innerHTML)&&(e.innerHTML=i)})),e.each(n,(function(e){e.innerHTML=i})),$("#leanoteNavContentMd").height("auto");try{$(i).text()||$("#leanoteNavContentMd").html("&nbsp; &nbsp; Nothing...")}catch(e){}var r=$("#leanoteNavContentMd").height(),s=$("#mdEditor").height()-100;r>s&&$("#leanoteNavContentMd").height(s)}))},i.onReady=function(){},i})),define("extensions/emailConverter",["classes/Extension"],(function(e){var n=new e("emailConverter","Markdown Email",!0);return n.onPagedownConfigure=function(e){e.getConverter().hooks.chain("postConversion",(function(e){return e.replace(/<(mailto\:)?([^\s>]+@[^\s>]+\.\S+?)>/g,(function(e,n,t){return'<a href="mailto:'+t+'">'+t+"</a>"}))}))},n})),define("extensions/containerConverter",["classes/Extension"],(function(e){var n=new e("containerConverter","Markdown Container",!0);return n.onPagedownConfigure=function(e){e.getConverter().hooks.chain("postConversion",(function(e){return e.replace(/::: (success|warning|info|danger) <br>\n(.+)\n:::/gm,(function(e,n,t){return'<div class="'+n+'">'+t+"</div>"}))}))},n})),define("extensions/todoList",["classes/Extension"],(function(e){var n=new e("todoList","Markdown todoList",!0);return n.onPagedownConfigure=function(e){e.getConverter().hooks.chain("postConversion",(function(e){return e.replace(/<li>(<p>)?\[([ xX]?)\] /g,(function(e,n,t){return n||(n=""),"x"!=t&&"X"!=t?'<li class="m-todo-item m-todo-empty">'+n+'<input type="checkbox" /> ':'<li class="m-todo-item m-todo-done">'+n+'<input type="checkbox" checked /> '}))}))},n})),define("extensions/scrollLink",["underscore","classes/Extension"],(function(e,n){var t,o,i=new n("scrollLink","Scroll Link",!0,!0);i.onAceCreated=function(e){t=e},i.onSectionsCreated=function(e){o=e};var r,a,s,l=0;i.onMarkdownTrim=function(e){l=e};var c,d,u=[],f=[],g=e.debounce((function(){u=[];var n,i=0,g=0,p=l;if(window.lightMode){a.innerWidth(r.innerWidth()),e.each(o,(function(e,n){var t=e.text;n!==o.length-1?0===t.length&&(t=void 0):/\n$/.test(t)&&(t+="\n"),function(e){var n=0;if(void 0!==e){var t=document.createTextNode(e);a.empty().append(t),n+=a.prop("scrollHeight")}var o=g+n;u.push({startOffset:g,endOffset:o,height:n}),g=o}(t)}));var m=e.last(u).endOffset,h=r[0].scrollHeight/m;u=e.map(u,(function(e){return{startOffset:e.startOffset*h,endOffset:e.endOffset*h,height:e.height*h}}))}else e.each(o,(function(e){i+=e.text.length+p,p=0;var n=t.session.doc.indexToPosition(i),o=t.session.documentToScreenPosition(n.row,n.column).row*t.renderer.lineHeight,r=o-g;u.push({startOffset:g,endOffset:o,height:r}),g=o}));f=[];var w=s.scrollTop();s.find(".preview-content > .se-section-delimiter").each((function(){if(void 0!==n){var e=$(this).position().top+w;f.push({startOffset:n,endOffset:e,height:e-n}),n=e}else n=0}));var v=s.prop("scrollHeight");f.push({startOffset:n,endOffset:v,height:v-n}),c=-10,d=-10,x()}),500);function p(n,t,o){var i,r=e.find(t,(function(e,t){return i=t,n<e.endOffset}));if(void 0!==r){var a=(n-r.startOffset)/(r.height||1),s=o[i];return s.startOffset+s.height*a}}var m=!1,h=!1,w=!1,v=!1,b=$("<div>"),x=e.throttle((function(){if(0!==u.length&&u.length===f.length){var n=window.lightMode?r.scrollTop():t.renderer.getScrollTop();n<0&&(n=0);var o,i=s.scrollTop();if(!0===m){if(Math.abs(n-c)<=9)return;if(m=!1,c=n,o=p(n,u,f),o=e.min([o,s.prop("scrollHeight")-s.outerHeight()]),Math.abs(o-i)<=9)return void(d=i);b.stop("scrollLinkFx",!0).css("value",0).animate({value:o-i},{easing:"linear",duration:200,queue:"scrollLinkFx",step:function(e){v=!0,d=i+e,s.scrollTop(d)},done:function(){e.defer((function(){v=!1}))}}).dequeue("scrollLinkFx")}else if(!0===h){if(Math.abs(i-d)<=9)return;if(h=!1,d=i,o=p(i,f,u),window.lightMode?o=e.min([o,r.prop("scrollHeight")-r.outerHeight()]):(o=e.min([o,t.session.getScreenLength()*t.renderer.lineHeight+t.renderer.scrollMargin.bottom-t.renderer.$size.scrollerHeight]))<0&&(o=0),Math.abs(o-n)<=9)return void(c=n);b.stop("scrollLinkFx",!0).css("value",0).animate({value:o-n},{easing:"linear",duration:200,queue:"scrollLinkFx",step:function(e){w=!0,c=n+e,window.lightMode||t.session.setScrollTop(c),window.lightMode&&r.scrollTop(c)},done:function(){e.defer((function(){w=!1}))}}).dequeue("scrollLinkFx")}}else x()}),100);i.onLayoutResize=function(){m=!0,g()},i.onFileClosed=function(){u=[]};var C=function(e){s=$(".preview-container"),r=$("#wmd-input"),a=$(".textarea-helper"),s.scroll((function(){!1===v&&!1===k&&(h=!0,m=!1,x()),k=!1}));var n=function(){!1===w&&(m=!0,h=!1,x())};setTimeout((function(){window.lightMode?r.scroll(n):t.session.on("changeScrollTop",n)}),e?500:0)};i.onToggleMode=function(){s=$(".preview-container"),r=$("#wmd-input"),a=$(".textarea-helper"),g(),C(!0)};var M,k=!1;return i.onReady=function(){s=$(".preview-container"),r=$("#wmd-input"),a=$(".textarea-helper"),C(),$(".extension-preview-buttons .table-of-contents, #preview-contents").on("click","a",(function(e){var n=this.hash;if(n){e.preventDefault();var o=$("#preview-contents "+decodeURIComponent(n));if(o.length){var i=o[0].getBoundingClientRect().top-s.get(0).getBoundingClientRect().top+s.scrollTop(),a=p(i,f,u);s.scrollTop(i),window.lightMode||t.session.setScrollTop(a),window.lightMode&&r.scrollTop(a)}}}))},i.onPagedownConfigure=function(e){M=$("#preview-contents"),e.getConverter().hooks.chain("postConversion",(function(e){return M.height(M.height()),e}))},i.onPreviewFinished=function(){var e=M.height();M.height("auto");var n=M.height();m=!0,n<e&&(k=!0),g()},i})),define("extensions/htmlSanitizer",["underscore","utils","classes/Extension"],(function(e,n,t){var o,i=new t("htmlSanitizer","HTML Sanitizer",!0);i.onPagedownConfigure=function(n){n.getConverter().hooks.chain("postConversion",(function(n){return o=[],n.split('<div class="se-preview-section-delimiter"></div>').forEach((function(n){!function(e,n){var t,i,g,p=[],h=e;function w(e,t,o,i){if(t=t&&t.toLowerCase(),b[t])for(;p.last()&&x[p.last()];)M("",p.last());v[t]&&p.last()==t&&M("",t),(i=m[t]||!!i)||p.push(t);var r={};o.replace(s,(function(e,n,t,o,i){var a=t||o||i||"";r[n]=E(a)})),n.start&&n.start(t,r,i)}function M(e,t){var o,i=0;if(t=t&&t.toLowerCase())for(i=p.length-1;i>=0&&p[i]!=t;i--);if(i>=0){for(o=p.length-1;o>=i;o--)n.end&&n.end(p[o]);p.length=i}}p.last=function(){return p[p.length-1]};for(;e;){if(i=!0,p.last()&&C[p.last()])e=e.replace(new RegExp("(.*)<\\s*\\/\\s*"+p.last()+"[^>]*>","i"),(function(e,t){return t=t.replace(d,"$1").replace(f,"$1"),n.chars&&n.chars(E(t)),""})),M(0,p.last());else if(0===e.indexOf("\x3c!--")?(t=e.indexOf("--",4))>=0&&e.lastIndexOf("--\x3e",t)===t&&(n.comment&&n.comment(e.substring(4,t)),e=e.substring(t+3),i=!1):u.test(e)?(g=e.match(u))&&(e=e.replace(g[0],""),i=!1):c.test(e)?(g=e.match(a))&&(e=e.substring(g[0].length),g[0].replace(a,M),i=!1):l.test(e)&&(g=e.match(r))&&(e=e.substring(g[0].length),g[0].replace(r,w),i=!1),i){var k=(t=e.indexOf("<"))<0?e:e.substring(0,t);e=t<0?"":e.substring(t),n.chars&&n.chars(E(k))}if(e==h)return p.reverse(),p.forEach((function(e){o.push("</"),o.push(e),o.push(">")}));h=e}M()}(n,function(n){var t=!1,o=e.bind(n.push,n);return{start:function(n,i,r){n=n&&n.toLowerCase(),!t&&C[n]&&(t=n),t||!0!==M[n]||(o("<"),o(n),e.forEach(i,(function(e,n){var t=n&&n.toLowerCase();!0===y[t]&&(k[t],1)&&(o(" "),o(n),o('="'),o($(e)),o('"'))})),o(r?"/>":">"))},end:function(e){e=e&&e.toLowerCase(),t||!0!==M[e]||(o("</"),o(e),o(">")),e==t&&(t=!1)},chars:function(e){t||o($(e))},comment:function(e){t||(o("\x3c!--"),o($(e)),o("--\x3e"))}}}(o)),o.push('<div class="se-preview-section-delimiter"></div>')})),o.slice(0,-1).join("")}))};
/**
     * @license AngularJS v1.2.16
     * (c) 2010-2014 Google, Inc. http://angularjs.org
     * License: MIT
     */
var r=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,a=/^<\s*\/\s*([\w:-]+)[^>]*>/,s=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,l=/^</,c=/^<\s*\//,d=/<!--(.*?)-->/g,u=/<!DOCTYPE([^>]*?)>/i,f=/<!\[CDATA\[(.*?)]]>/g,g=/([^\#-~| |!])/g;function p(e){var n,t={},o=e.split(",");for(n=0;n<o.length;n++)t[o[n]]=!0;return t}var m=p("area,br,col,hr,img,wbr"),h=p("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),w=p("rp,rt"),v=e.extend({},w,h),b=e.extend({},h,p("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul,embed,iframe")),x=e.extend({},w,p("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var,input")),C=p("script"),M=e.extend({},m,b,x,v),k=p("background,cite,href,longdesc,src,usemap"),y=e.extend({},k,p("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width,checked,style"));y.id=!0,y.allowfullscreen=!0;var S=document.createElement("pre"),T=/^(\s*)([\s\S]*?)(\s*)$/;function E(e){if(!e)return"";var n=T.exec(e),t=n[1],o=n[3],i=n[2];return i&&(S.innerHTML=i.replace(/</g,"&lt;"),i="textContent"in S?S.textContent:S.innerText),t+i+o}function $(e){return e.replace(/&/g,"&amp;").replace(g,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}return i})),define("eventMgr",["underscore","crel","utils","classes/Extension","settings","extensions/markdownSectionParser","extensions/partialRendering","extensions/prismJsToolbar","extensions/umlDiagrams","extensions/toc","extensions/scrollLink","jquery-waitforimages"],(function(e,n,t,o,i,r){var a={},s=e.chain(arguments).map((function(e){return e instanceof o&&e})).compact().value(),l=i.extensionSettings||{};function c(n){return e.chain(s).map((function(e){return e.enabled&&e[n]})).compact().value()}e.each(s,(function(n){n.config=e.extend({},n.defaultConfig,l[n.extensionId]),!0===window.viewerMode&&!0===n.disableInViewer||!0===window.lightMode&&!0===n.disableInLight?n.enabled=!1:n.enabled=!n.isOptional||void 0===n.config.enabled||!0===n.config.enabled}));var d={};function u(n){return d[n]=c(n),function(){var t=arguments;e.each(d[n],(function(n){try{n.apply(null,t)}catch(n){console.error(e.isObject(n)?n.stack:n)}}))}}function f(e){a[e]=u(e)}a.addListener=function(e,n){try{d[e].push(n)}catch(n){console.error("No event listener called "+e)}},u("onInit")(),a.onLoadSettings=function(){e.each(s,(function(e){var n=!e.isOptional||void 0===e.config.enabled||!0===e.config.enabled;t.setInputChecked("#input-enable-extension-"+e.extensionId,n),"markdownExtra"==e.extensionId?t.setInputChecked("#input-settings-markdown-extra",n):"mathJax"==e.extensionId&&t.setInputChecked("#input-settings-mathjax",n);var o=e.onLoadSettings;o&&o()}))},a.onSaveSettings=function(n,o){e.each(s,(function(i){if(!0!==window.lightMode||!0!==i.disableInLight){var r,a=e.extend({},i.defaultConfig);a.enabled=t.getInputChecked("#input-enable-extension-"+i.extensionId),"markdownExtra"==i.extensionId?(r=t.getInputChecked("#input-settings-markdown-extra"))!=i.enabled&&(a.enabled=r):"mathJax"==i.extensionId&&(r=t.getInputChecked("#input-settings-mathjax"))!=i.enabled&&(a.enabled=r);var s=i.onSaveSettings;s&&s(a,o),n[i.extensionId]=a}else n[i.extensionId]=i.config}))},f("onMessage"),f("onError"),f("onPeriodicRun"),f("onFileMgrCreated"),f("onSynchronizerCreated"),f("onPublisherCreated"),f("onEventMgrCreated"),f("onFileCreated"),f("onFileDeleted"),f("onFileSelected"),f("onFileOpen"),f("onFileClosed"),f("onContentChanged"),f("onToggleMode"),f("onLayoutConfigure"),f("onLayoutCreated"),f("onLayoutResize"),f("onPagedownConfigure"),f("onSectionsCreated"),f("onMarkdownTrim"),f("onAceCreated");var g,p,m=u("onPreviewFinished"),h=c("onAsyncPreview");a.onAsyncPreview=function(){!function n(o){(o.length?o.shift():function(){e.defer((function(){var n="";e.each(g.children,(function(e){n+=e.innerHTML})),n=n.replace(/^<div class="se-section-delimiter"><\/div>\n\n/gm,"");var o=t.trim(n),i=o.replace(/ <span class="comment label label-danger">.*?<\/span> /g,"");m(o,i)}))})((function(){n(o)}))}(h.concat([function(e){p.waitForImages(e)}]))};var w=u("onReady");return a.onReady=function(){g=document.getElementById("preview-contents"),p=$(g);var t=function(t){var o=n("div",{class:"btn-group"}),i=t();return e.isString(i)?o.innerHTML=i:e.isElement(i)&&o.appendChild(i),o};if(!1===window.viewerMode){var o=c("onCreateEditorButton"),i=document.createDocumentFragment();e.each(o,(function(e){i.appendChild(t(e))}))}var r=c("onCreatePreviewButton"),a=document.createDocumentFragment();e.each(r,(function(e){a.appendChild(t(e))}));var s=document.querySelector(".extension-preview-buttons");s.appendChild(a);var l=$(s),d=l.width();l.find(".btn-group").each((function(){var e=$(this);e.find(".dropdown-menu").css({right:-d+e.width()+e.position().left})})),w()},a.onEventMgrCreated(a),a})),define("shortcutMgr",["underscore","eventMgr","utils"],(function(e,n,t,o){var i={},r={bold:{title:"Strong",defaultKey:{win:"Ctrl-B",mac:"Command-B|Ctrl-B"},isPageDown:!0},italic:{title:"Emphasis",defaultKey:{win:"Ctrl-I",mac:"Command-I|Ctrl-I"},isPageDown:!0},link:{title:"Hyperlink",defaultKey:{win:"Ctrl-L",mac:"Command-L|Ctrl-L"},isPageDown:!0},quote:{title:"Blockquote",defaultKey:{win:"Ctrl-Q",mac:"Command-Q|Ctrl-Q"},isPageDown:!0},code:{title:"Code Sample",defaultKey:{win:"Ctrl-K",mac:"Command-K|Ctrl-K"},isPageDown:!0},image:{title:"Image",defaultKey:{win:"Ctrl-G",mac:"Command-G|Ctrl-G"},isPageDown:!0},olist:{title:"Numbered List",defaultKey:{win:"Ctrl-O",mac:"Command-O|Ctrl-O"},isPageDown:!0},ulist:{title:"Bulleted List",defaultKey:{win:"Ctrl-U",mac:"Command-U|Ctrl-U"},isPageDown:!0},heading:{title:"Heading",defaultKey:{win:"Ctrl-H",mac:"Command-H|Ctrl-H"},isPageDown:!0},hr:{title:"Horizontal Rule",defaultKey:{win:"Ctrl-R",mac:"Command-R|Ctrl-R"},isPageDown:!0},undo:{title:"Undo",defaultKey:{win:"Ctrl-Z",mac:"Command-Z"},exec:function(e){e.undo()},isPageDown:!0},redo:{title:"Redo",defaultKey:{win:"Ctrl-Y|Ctrl-Shift-Z",mac:"Command-Y|Command-Shift-Z"},exec:function(e){e.redo()},isPageDown:!0},selectall:{title:"Select All",defaultKey:{win:"Ctrl-A",mac:"Command-A"},exec:function(e){e.selectAll()},readOnly:!0},removeline:{title:"Remove Line",defaultKey:{win:"Ctrl-D",mac:"Command-D"},exec:function(e){e.removeLines()},multiSelectAction:"forEachLine"},duplicateSelection:{title:"Duplicate Selection",defaultKey:{win:"Ctrl-Shift-D",mac:"Command-Shift-D"},exec:function(e){e.duplicateSelection()},multiSelectAction:"forEach"},sortlines:{title:"Sort Lines",defaultKey:{win:"Ctrl-Alt-S",mac:"Command-Alt-S"},exec:function(e){e.sortLines()},multiSelectAction:"forEachLine"},modifyNumberUp:{title:"Number Up",defaultKey:{win:"Ctrl-Shift-Up",mac:"Alt-Shift-Up"},exec:function(e){e.modifyNumber(1)},multiSelectAction:"forEach"},modifyNumberDown:{title:"Number Down",defaultKey:{win:"Ctrl-Shift-Down",mac:"Alt-Shift-Down"},exec:function(e){e.modifyNumber(-1)},multiSelectAction:"forEach"},find:{title:"Find",defaultKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(e){ace.require("ace/config").loadModule("ace/ext/searchbox",(function(n){n.Search(e)}))},readOnly:!0},replace:{title:"Replace",defaultKey:{win:"Ctrl-Shift-F",mac:"Command-Option-F"},exec:function(e){require("ace/config").loadModule("ace/ext/searchbox",(function(n){n.Search(e,!0)}))},readOnly:!0},findnext:{title:"Find Next",defaultKey:{win:"Ctrl-P",mac:"Command-P"},exec:function(e){e.findNext()},readOnly:!0},findprevious:{title:"Find Previous",defaultKey:{win:"Ctrl-Shift-P",mac:"Command-Shift-P"},exec:function(e){e.findPrevious()},readOnly:!0},togglerecording:{title:"Toggle Recording",defaultKey:{win:"Ctrl-Alt-E",mac:"Command-Option-E"},exec:function(e){e.commands.toggleRecording(e)},readOnly:!0},replaymacro:{title:"Replay Macro",defaultKey:{win:"Ctrl-Shift-E",mac:"Command-Shift-E"},exec:function(e){e.commands.replay(e)},readOnly:!0}};return e.each(r,(function(e,n){e.name=n,e.bindKey=e.defaultKey})),i.configureAce=function(n){e.each(r,(function(t){t.exec&&n.commands.addCommand(e.pick(t,"name","bindKey","exec","readOnly","multiSelectAction"))}))},i.getPagedownKeyStrokes=function(){return e.chain(r).where({isPageDown:!0}).map((function(e){return[e.name,e.bindKey]})).object().value()},i})),define("core",["underscore","crel","constants","utils","eventMgr","shortcutMgr","pagedown-ace","pagedown-light"],(function(e,n,t,o,i,r){var a={};window.MD={eventMgr:i};var s,l,c,d,u,f,g,p,m,h=$('<div class="modal fade modal-insert-link"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+getMsg("Hyperlink")+'</h4></div><div class="modal-body"><p>'+getMsg("Please provide the link URL and an optional title")+':</p><div class="input-group"><span class="input-group-addon"><i class="fa fa-link"></i></span><input id="input-insert-link" type="text" class="col-sm-5 form-control" placeholder="http://example.com  '+getMsg("optional title")+'"></div></div><div class="modal-footer"><a href="#" class="btn btn-default" data-dismiss="modal">'+getMsg("Cancel")+'</a> <a href="#" class="btn btn-primary action-insert-link" data-dismiss="modal">'+getMsg("OK")+"</a></div></div></div></div>"),w=h.find(".action-insert-link");function v(){s=ace.edit("wmd-input"),MD.aceEditor=s,s.setTheme("ace/theme/chrome"),s.renderer.setShowGutter(!1),s.renderer.setPrintMarginColumn(!1),s.renderer.setPadding(t.EDITOR_DEFAULT_PADDING),s.session.setUseWrapMode(!0),s.session.setNewLineMode("unix"),s.session.setMode("ace/mode/markdown"),s.session.$selectLongWords=!0,s.getSession().on("change",(function(){content=getEditorContent(!0)[0],msg="字数："+calcWords(content),$("#calcWords").text(msg)})),function(n){function t(t){var o=n.lines[t];0!==o.length&&0===o[0].type.indexOf("markup.heading.multi")&&e.each(n.lines[t-1],(function(e){e.type="markup.heading.prev.multi"}))}function o(){if(n.running){for(var e=new Date,i=n.currentLine,r=-1,a=n.doc;n.lines[i];)i++;var s=i,l=a.getLength(),c=0;for(n.running=!1;i<l;){n.$tokenizeRow(i),r=i;do{t(i),i++}while(n.lines[i]);if(++c%5==0&&new Date-e>20)return n.running=setTimeout(o,20),void(n.currentLine=i)}n.currentLine=i,s<=r&&n.fireUpdateEvent(s,r)}}n.$worker=function(){n.lines.splice(0,n.lines.length),n.states.splice(0,n.states.length),n.currentLine=0,o()}}(s.session.bgTokenizer),r.configureAce(s),i.onAceCreated(s)}a._resetToolBar=function(){$("#wmd-button-row").remove(),$("#wmd-button-bar .wmd-button-bar-inner").html('<ul class="nav left-buttons"><li class="wmd-button-group1 btn-group"></li></ul><ul class="nav left-buttons"><li class="wmd-button-group2 btn-group"></li></ul><ul class="nav left-buttons"><li class="wmd-button-group3 btn-group"></li></ul><ul class="nav left-buttons"><li class="wmd-button-group4 btn-group"></li></ul><ul class="nav left-buttons"><li class="wmd-button-group6 btn-group"></li><li class="wmd-button btn btn-success" id="wmd-help-button" title="'+getMsg("Markdown syntax")+'" style="left:0;display:none"><span style="display:none;background-position:0 0"></span><i class="fa fa-question-circle"></i></li></ul>')},a._setEditorHook=function(){c.hooks.set("insertLinkDialog",(function(e){return a.insertLinkCallback=e,o.resetModalInputs(),h.modal(),!0})),c.hooks.set("insertImageDialog",(function(e){if(a.insertLinkCallback=e,a.catchModal)return!0;o.resetModalInputs();var n=$("#leauiIfrForMD");return n.attr("src")||n.attr("src","/album/index?md=1"),$(".modal-insert-image").modal(),!0})),c.hooks.chain("onPreviewRefresh",i.onAsyncPreview)},a._moveCursorTo=function(e,n){if(window.lightMode){var t=a._getTextareaCursorOffset(e,n);$("#wmd-input").get(0).setSelectionRange(t,t),$("#wmd-input").focus()}else s.moveCursorTo(e,n)},a._getTextareaCusorPosition=function(){var e=$("#wmd-input").get(0).selectionStart;if(0==e)return{row:0,column:0};var n=(MD.getContent()||"").split("\n"),t=0,o=0;for(t=0;t<n.length;++t){var i=n[t];if(e<=i.length){o=e;break}e-=i.length,e--}return{row:t,column:o}},a._getTextareaCursorOffset=function(e,n){for(var t=0,o=MD.getContent().split("\n"),i=(t=0,0);i<o.length&&i<e;++i)t+=o[i].length+1;return(t+=n)+1},a.initLightEditor=function(){if(!window.lightMode){var e,n;s?(e=s.renderer.getScrollTop(),n=s.getCursorPosition()):(e=0,n=0);var t=MD.getContent();a._resetToolBar(),s&&s.destroy(),$("#wmd-input").replaceWith((function(){return $('<textarea id="wmd-input" class="ace_editor ace-tm wmd-textarea">').addClass(this.className).addClass("form-control")})),a._pre(),c=new Markdown.EditorLight(p),a._setEditorHook(),c.run(g),a._setToolBars(),d.val(t),window.lightMode=!0,s=null,MD.clearUndo(),i.onToggleMode(c),a._moveCursorTo(n.row,n.column),d.focus(),$("#wmd-input").scrollTop(e),$("#calcWords").text("")}},a.initAceEditor=function(){if(window.lightMode){var e=$("#wmd-input").scrollTop(),n=a._getTextareaCusorPosition(),o=MD.getContent();a._resetToolBar(),s&&s.destroy(),$("#wmd-input").replaceWith((function(){return'<pre id="wmd-input" class="form-control"><div id="wmd-input-sub" class="editor-content mousetrap" contenteditable=true></div><div class="editor-margin"></div></pre>'})),a._pre(),v(),d.find(".ace_content").css({"background-size":"64px "+Math.round(t.fontSize*(20/12))+"px"}),c=new Markdown.Editor(p,void 0,{keyStrokes:r.getPagedownKeyStrokes()}),a._setEditorHook(),c.run(s,g),a._setToolBars(),s.setValue(o,-1),window.lightMode=!1,MD.clearUndo(),i.onToggleMode(c),a._moveCursorTo(n.row,n.column),s.focus(),s.session.setScrollTop(e),o=getEditorContent(!0)[0],$("#calcWords").text("字数："+calcWords(o))}},a._initMarkdownConvert=function(){return MDConverter=function(){function e(){}e.prototype={set:function(e,n){this["s_"+e]=n},get:function(e){return this["s_"+e]}};var n,t=this.hooks=new Markdown.HookCollection;t.addNoop("preConversion"),t.addNoop("postConversion"),this.pluginHooks=t,this.makeHtml=function(o){if(n)throw new Error("Recursive call to converter.makeHtml");n=new e,new e,[],0;var i=window.markdownit({html:!0}).use(window.markdownitEmoji).use(window.markdownitKatex).use(window.markdownitPrismjs,{plugins:["toolbar","line-numbers"]}).use(window.markdownitTaskLists).use(window.markdownitContainer,"success").use(window.markdownitContainer,"info").use(window.markdownitContainer,"warning").use(window.markdownitContainer,"danger");return o=t.preConversion(o),o=i.render(o),o=t.postConversion(o),n=null,o}},p=new MDConverter},a.initEditor=function(n){void 0!==u&&i.onFileClosed(u),n||(n={content:""}),f=void 0;var t=(u=n).content;if(window.lightMode?d.val(t):s.setValue(t,-1),void 0!==c)return window.lightMode||s&&u.editorSelectRange&&s.selection.setSelectionRange(u.editorSelectRange),c.refreshPreview(),MD.$editorElt=d,void(window.lightMode?d.scrollTop(0):e.defer((function(){s.renderer.scrollToY(0)})));var o=$(".preview-container");c=window.lightMode?new Markdown.EditorLight(p):new Markdown.Editor(p,void 0,{keyStrokes:r.getPagedownKeyStrokes()}),a._setEditorHook(),g=function(n){var t=e.debounce(n,500);return function(){var r;void 0===f?(n(),i.onFileOpen(u),o.scrollTop(u.previewScrollTop),window.lightMode?d.scrollTop(u.editorScrollTop):e.defer((function(){s.renderer.scrollToY(u.editorScrollTop)}))):t(),r=d.val(),!window.lightMode&&s&&(r=s.getValue()),void 0!==f&&f!=r&&(u.content=r,i.onContentChanged(u)),f=r}},i.onPagedownConfigure(c),window.lightMode?(c.run(g),c.undoManager.reinit(t,u.editorStart,u.editorEnd,u.editorScrollTop)):(c.run(s,g),u.editorSelectRange&&s.selection.setSelectionRange(u.editorSelectRange))},a._setToolBars=function(){$(".wmd-button-row li").addClass("btn btn-success").css("left",0).find("span").hide();var e=$(".wmd-button-group1");$("#wmd-bold-button").append($('<i class="fa fa-bold">')).appendTo(e),$("#wmd-italic-button").append($('<i class="fa fa-italic">')).appendTo(e),e=$(".wmd-button-group2"),$("#wmd-link-button").append($('<i class="fa fa-link">')).appendTo(e),$("#wmd-quote-button").append($('<i class="fa fa-quote-left">')).appendTo(e),$("#wmd-code-button").append($('<i class="fa fa-code">')).appendTo(e),$("#wmd-image-button").append($('<i class="fa fa-picture-o">')).appendTo(e),e=$(".wmd-button-group3"),$("#wmd-olist-button").append($('<i class="fa fa-list-ol">')).appendTo(e),$("#wmd-ulist-button").append($('<i class="fa fa-list-ul">')).appendTo(e),$("#wmd-heading-button").append($('<i class="fa fa-header">')).appendTo(e),$("#wmd-hr-button").append($('<i class="fa fa-ellipsis-h">')).appendTo(e),$("#wmd-undo-button").append($('<i class="fa fa-undo">')).appendTo(e),$("#wmd-redo-button").append($('<i class="fa fa-repeat">')).appendTo(e),a._initModeToolbar()},a.setMDApi=function(){MD.focus=function(){window.lightMode?$("#wmd-input").focus():s.focus()},MD.setContent=function(e){var n={content:e};a.initEditor(n)},MD.setContent(""),MD.getContent=function(){return window.lightMode?$("#wmd-input").val():s.getValue()},MD.onResize=function(){i.onLayoutResize()},MD.resize=function(){window.lightMode||s.resize()},MD.clearUndo=function(){window.lightMode?c.undoManager.reinit():s.getSession().setUndoManager(new ace.UndoManager),c.uiManager.setUndoRedoButtonStates()},MD.toggleToAce=function(){a.initAceEditor()},MD.toggleToLight=function(){a.initLightEditor()},MD.setModeName=function(e){"textarea"===e&&(e="Normal");var n=getMsg(e);m.html(n)},MD.changeAceKeyboardMode=function(e,n){if(localS.set(localSModeKey,e),window.lightMode){if("light"==e)return;a.initAceEditor(),MD.defaultKeyboardMode||(MD.defaultKeyboardMode=s.getKeyboardHandler())}else if("light"==e)return void a.initLightEditor();"vim"!=e&&"emacs"!=e?s.setKeyboardHandler(MD.defaultKeyboardMode):s.setKeyboardHandler("ace/keyboard/"+e)}},a._initModeToolbar=function(){if(!window.lightModeForce&&($(".wmd-button-group4").html(['<div class="btn-group">','<button type="button" class="wmd-button btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" title="'+getMsg("Edit mode")+'">','<i class="fa fa-gear"></i> <i id="md-keyboard-mode"></i>',"</button>",'<ul class="dropdown-menu wmd-mode">','<li><a href="#" data-mode="Normal"><i class="fa fa-check"></i> '+getMsg("Normal mode")+"</a></li>",'<li><a href="#" data-mode="Vim"><i class="fa"></i> '+getMsg("Vim mode")+"</a></li>",'<li><a href="#" data-mode="Emacs"><i class="fa"></i> '+getMsg("Emacs mode")+"</a></li>",'<li role="separator" class="divider"></li>','<li><a href="#" data-mode="Light"><i class="fa"></i> '+getMsg("Light editor")+"</a></li>","</ul>","</div>"].join("")),$("#wmd-help-button").show(),m=$("#md-keyboard-mode"),$(".wmd-mode a").click((function(){var e=$(this).data("mode");MD.changeAceKeyboardMode(e.toLowerCase(),e),MD.setModeName(e),$(".wmd-mode").find("i").removeClass("fa-check"),$('.wmd-mode a[data-mode="'+e+'"]').find("i").addClass("fa-check")})),!window.LEA||window.LEA&&window.LEA.canSetMDModeFromStorage&&window.LEA.canSetMDModeFromStorage())){var e=localS.get(localSModeKey);if(!e)return;var n=e[0].toUpperCase()+e.substr(1);$(".wmd-mode i").removeClass("fa-check"),$('.wmd-mode a[data-mode="'+n+'"] i').addClass("fa-check"),MD.setModeName(n)}},a._pre=function(){d=$("#wmd-input, .textarea-helper").css({"font-family":t.fontFamily,"font-size":t.fontSize+"px","line-height":Math.round(t.fontSize*(20/12))+"px"})};return a.onReady=function(){if(l=$(".navbar"),l.find(".left-buttons"),l.find(".right-buttons"),l.find(".left-buttons-dropdown"),l.find(".right-buttons-dropdown"),window.lightMode&&$("#wmd-input").replaceWith((function(){return $('<textarea id="wmd-input" class="ace_editor ace-tm wmd-textarea">').addClass(this.className).addClass("form-control")})),a._pre(),window.lightMode||(v(),d.find(".ace_content").css({"background-size":"64px "+Math.round(t.fontSize*(20/12))+"px"})),i.onReady(),a._initMarkdownConvert(),a.initEditor(),a.setMDApi(),a._setToolBars(),window.lightMode||(MD.defaultKeyboardMode=s.getKeyboardHandler()),!window.LEA||window.LEA&&window.LEA.canSetMDModeFromStorage&&window.LEA.canSetMDModeFromStorage()){var e=localS.get(localSModeKey);if(!window.lightMode&&e){var n=e[0].toUpperCase()+e.substr(1);MD.changeAceKeyboardMode(e,n)}}},i.addListener("onReady",(function(){$(document.body).on("shown.bs.modal",".modal",(function(){var e=$(this);setTimeout((function(){e.find(".btn:first").focus(),e.find("button:first").focus(),e.find("input:enabled:visible:first").focus()}),50)})).on("hidden.bs.modal",".modal",(function(){})).on("keypress",".modal",(function(e){13!=e.which||$(e.target).is("textarea")||$(this).find(".modal-footer a:last").click()})),w.click((function(e){var n=o.getInputTextValue($("#input-insert-link"),e);if(void 0!==n){var t=n.split(" "),i="",r=t[0];t.length>1&&(t.shift(),i=$.trim(t.join(" "))),r&&r.indexOf("://")<0&&(r="http://"+r),a.insertLinkCallback(r,i),a.insertLinkCallback=void 0}})),$(".action-insert-image").click((function(){var e=document.getElementById("leauiIfrForMD").contentWindow.mdGetImgSrc();e&&(a.insertLinkCallback(e),a.insertLinkCallback=void 0)})),h.on("hidden.bs.modal",(function(){void 0!==a.insertLinkCallback&&(a.insertLinkCallback(null),a.insertLinkCallback=void 0)})),$("div.dropdown-menu").click((function(e){e.stopPropagation()})),$("#wmd-button-bar").on("click","#wmd-help-button",(function(){window.open("http://leanote.leanote.com/post/Leanote-Markdown-Manual")}))})),a})),requirejs.config({waitSeconds:0,packages:[],paths:{underscore:"/public/libs/underscore-1.10.2.min",crel:"/public/libs/crel-1.1.2.min","jquery-waitforimages":"/public/libs/jquery/jquery.waitforimages-1.4.2.min",ace:"/public/libs/ace","pagedown-ace":"/public/libs/pagedown-ace/Markdown.Editor","pagedown-light":"/public/libs/pagedown-ace/Markdown.Editor.Light","pagedown-extra":"/public/libs/pagedown-ace/Markdown.Extra","ace/requirejs/text":"libs/ace_text","ace/commands/default_commands":"libs/ace_commands",xregexp:"/public/libs/xregexp-all-3.0.0.min",Diagram:"libs/uml/sequence-diagram.min","diagram-grammar":"libs/uml/diagram-grammar.min",raphael:"libs/uml/raphael.min","flow-chart":"libs/uml/flowchart.amd-1.3.4.min"},shim:{underscore:{exports:"_"},"pagedown-extra":["pagedown-ace"],"pagedown-ace":["ace/range"],"pagedown-light":[],"flow-chart":["raphael"],"diagram-grammar":["underscore"],Diagram:["raphael","diagram-grammar"]}});var localS={get:function(e){if(localStorage)return localStorage.getItem(e)},set:function(e,n){n+="",localStorage&&localStorage.setItem(e,n)}},localSModeKey="LeaMdAceMode";if(window.viewerMode=!1,window.lightModeForce=window.viewerMode||/_light_/.test(localStorage.mode)||/(\?|&)light($|&)/.test(location.search)||function(e){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))return!0}(navigator.userAgent||navigator.vendor||window.opera),window.lightModeForce)window.lightMode=!0;else{var mode=localS.get(localSModeKey);"light"===mode&&(window.lightMode=!0)}window.theme=localStorage.themeV3||"default";var themeModule="less!themes/default";require(["core","eventMgr"],(function(e,n){$((function(){e.onReady()}))})),define("main",(function(){}));